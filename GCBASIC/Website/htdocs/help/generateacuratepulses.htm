<html><head>
   <title>Generate Accurate Pulses</title>
   <meta name="generator"  content="HelpMaker.net" >
   <meta name="keywords"  content="," ></head>
<body bgcolor="FFFCEA" >
<table width="100%"  border="0"  cellspacing="0"  cellpadding="2"  bgcolor="C0C0C0" >
  <tr>
    <td align="left" >
      <div align="left" ><font face="Arial"  color="#010101"  size="4" ><span style="font-size:14pt" >Generate Accurate Pulses</span></font><font color="#010101" ></font></div>

    </td>
    <td align="right" >
      <font face="Arial"  size="2" >
        <a href="flashingledwithtimingparameters.htm">Previous</a>&nbsp;&nbsp;<a href="graphicallcddemonstration.htm">Next</a>
      </font>
    </td>
  </tr></table>
<hr><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial"  color="#010101" ><span style="font-size:12pt" ><b>Introduction</b></span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >The PulseOut Command is a reliable method for generating pulses if 
accuracy is not critical, the PulseOut command uses a calculation of the clock 
to speed for the timing .&nbsp; </span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >If you need better accuracy and resolution then an alternative approach is 
required.&nbsp;&nbsp; </span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >To generate pulses in the 100 us to 2500 us range with an accuracy of +- 1us 
over this range is practical using the approach shown in this example. </span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >This example code works on a midrange PIC16F690 operating at 8Mhz. 
However, it should work on any Microchip microprocessor, but may need 
some minor modifications.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" ><b>Usage</b></span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >Pulse_Out_us ( word_value )</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" ><b>How It Works</b></span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >Timer1 is loaded with a preset value based upon the variable passed to the 
sub routine.&nbsp; The timer (Timer1) is started and the pulse pin (the output pin) 
is set high.&nbsp;&nbsp; When Timer1 overflows the Timer1 interrupt flag bit (TMR1IF) is 
set.&nbsp; This causes the program to exit a polling loop and set the pulse Pin off. 
Then, Timer1 is stopped and TMRIF flag is cleared and the sub routine exits.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >This method supports delays between 5 us and 65535 us and uses Timer1.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ><br></font></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" ><b>Test Results</b></span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Arial" ><span style="font-size:12pt" >These tests were completed using a Saleae Logic Analyzer.</span></font><font color="#010101" ></font></div><div align="left" ><font color="#010101" ></font></div><table border="1"  width="553"  cellpadding="3"  cellspacing="0"  style="border-collapse: collapse; border: none" >
    <tr>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" ><b>Pulse setting</b></span></font><font color="#010101" ></font></div>
    </td>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" ><b>Time Results</b></span></font><font color="#010101" ></font></div>
    </td></tr>
    <tr>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >Pulse_Out_us (2500)</span></font><font color="#010101" ></font></div>
    </td>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >2501.375 us</span></font><font color="#010101" ></font></div>
    </td></tr>
    <tr>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >Pulse_Out_us (1000)</span></font><font color="#010101" ></font></div>
    </td>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >1000.750 us</span></font><font color="#010101" ></font></div>
    </td></tr>
    <tr>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >Pulse_Out_us (100)</span></font><font color="#010101" ></font></div>
    </td>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >100. 125 us</span></font><font color="#010101" ></font></div>
    </td></tr>
    <tr>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >Pulse_Out_us (10)</span></font><font color="#010101" ></font></div>
    </td>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >10.125 us</span></font><font color="#010101" ></font></div>
    </td></tr>
    <tr>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >Pulse_Out_us with less then 4</span></font><font color="#010101" ></font></div>
    </td>
    <td valign="top"  width="267"  style="border: solid #010101 1px;" >
    <div align="left" ><font face="Arial" ><span style="font-size:12pt" >Unreliable results</span></font><font color="#010101" ></font></div>
    </td></tr></table><div align="left" ><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >;**************************************</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >; Code:&nbsp; Output an accurate pulse</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >; Author: William Roth 03/13/2015</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >;**************************************</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >#chip 16F690,8</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >; ---- Define Hardware settings</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >; ---- Define I2C settings - CHANGE PORTS AS REQUIRED</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define I2C_MODE Master</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define I2C_DATA PORTB.4</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define I2C_CLOCK PORTB.6</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define I2C_DISABLE_INTERRUPTS ON</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >; ---- Set up LCD - Using I2C LCD Backpack</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define LCD_IO 10</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define LCD_I2C_Address_1 0x4e ; default to 0x4E</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >; ----&nbsp; May need to use SLOW or MEDIUM if your LCD is a 
slower device.</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define LCD_SPEED Medium</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define LCD_Backlight_On_State&nbsp; 1</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define LCD_Backlight_Off_State 0</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >CLS</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >; ---- USART settings</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define USART_BAUD_RATE 38400</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >DIR PORTB.7 OUT</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >; ---- Setup Pulse parameters</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >#define PulsePin PORTC.4</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Dim Time_us As WORD</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Dir PulsePin Out&nbsp;&nbsp;&nbsp;&nbsp; 'Pulsout pin</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Set PulsePin off</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >; ---- Setup Timer</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >InitTimer1 Osc, PS1_2&nbsp; 'For 8Mhz Chip</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >'InitTimer1 Osc, PS1_4, 'For 16 Mhz Chip</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >TMR1H = 0: TMR1L = 0&nbsp;&nbsp; 'Clear timer1</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >TMR1IF = 0&nbsp; 'Clear timer1 int flag</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >TMR1IE = on 'Enable timer1 Interrupt (Flag only)</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >' **** This is the MAIN loop *****</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Do</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; PULSE_OUT_US (2500)&nbsp; 'Measured as 2501.375 us</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; wait 19 ms</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; Pulse_Out_US (1000)&nbsp; 'Measured as 1000.750 us</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; wait 19 ms</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; Pulse_Out_US (100)&nbsp;&nbsp; 'Measured as 100.125 us</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; wait 19 ms</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; Pulse_Out_US (10)&nbsp;&nbsp;&nbsp; 'Measured as 10.125 us</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; Wait 19 ms</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >loop</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></font></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font face="Courier New" ><span style="font-size:10pt" >SUB PULSE_OUT_US (IN Variable as WORD)</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >TMR1H = 65535 - Variable_H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Timer 1 Preset 
High</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >TMR1L = (65535 - Variable) + 4&nbsp; 'Timer 1 Preset Low</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Set TMR1ON ON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Start timer1</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Set PulsePin ON&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Set Pin high</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Do While TMR1IF = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Wait&nbsp; for Timer1 overflow</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; Loop</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Set PulsePin off &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Pin Low</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >Set TMR1ON OFF&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Stop timer 1</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:38mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >TMR1IF = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 'Clear the Int flag</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><font face="Courier New" ><span style="font-size:10pt" >END SUB</span></font><font color="#010101" ></font></div><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ><br></font></div><font color="#010101" ><div align="left"  style="margin-left:25mm; margin-right:0mm; text-indent:0mm; " ></font><font color="#010101" ></font></div><div align="left" ><font face="Arial" ><span style="font-size:12pt" ><b>Also see </b></span></font><a href="pulseout.htm"><font face="Arial"  color="#0000ff" ><span style="font-size:12pt" ><b><u>PulseOut</u></b></span></font></a><font color="#010101" ></font></div>

</html>
