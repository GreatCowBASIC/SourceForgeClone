<html><head>
   <title>SonyRemote.h</title>
   <meta name="generator"  content="HelpMaker.net" >
   <meta name="keywords"  content="," ></head>
<body bgcolor="FFFCEA" >
<table width="100%"  border="0"  cellspacing="0"  cellpadding="2"  bgcolor="C0C0C0" >
  <tr>
    <td align="left" >
      <div align="left" ><font face="Arial"  size="4" ><span style="font-size:14pt" >SonyRemote.h</span></font><font color="#010101" ></font></div>

    </td>
    <td align="right" >
      <font face="Arial"  size="2" >
        <a href="infraredremote.htm">Previous</a>&nbsp;&nbsp;<a href="midpointcirclealgorithm.htm">Next</a>
      </font>
    </td>
  </tr></table>
<hr><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Sony IR Remote Control Library for Great Cow Basic</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Thomas Henry</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Version 2.0 -- 4/23/2014</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;This include file will let you easily read and use the</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;infrared signals from a Sony compatible television remote</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;control. In particular, the remote control transmits a</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;pulse modulated signal, the sensor detects this, and the</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;subroutine in this header file decodes the signal,</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;returning two numbers: one representing the device</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;(television, VCR, DVD, tuner, etc.), while the the other</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;returns the key which has been depressed (VOL+, MUTE,</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;channel numbers 0 through 9, etc.).</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;This has been tested and confirmed with a fixed</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;remote control purchased surplus for $2.00 from All</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Electronics, as well as an universal remote control, set</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;to Sony mode.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Moreover it has also been tested with a Panasonic IR</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;sensor and a Vishay sensor, both purchased surplus for</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;about fifty cents.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Every combination performed well, and it is probably the;</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;case that most any garden variety 38 kHz IR sensor will</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;work. The only tricky bit is making sure you get the pinout</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;for your sensor correct; search out the datasheet for</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;whichever device you use. There are only three pins:</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Ground</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Vcc</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Data</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;It is essential to filter the power applied to the Vcc pin.</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Do this by connecting a 100 ohm resistor from the +5V power</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;supply to the Vcc pin, and bridge the pin to ground with a</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;4.7uF electrolytic capacitor.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;The Data pin requires a 4.7k pullup resistor.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;There is only one constant required of the calling program.</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;It indicates which port line the IR sensor is connected to.</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;For example,</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;#DEFINE IR_DATA_PIN PORTA.0</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;There is one subroutine:</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;readIR_Remote(IR_rem_dev, IR_rem_key)</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;The values returned are, respectively, the device number</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;mentioned earlier and the key that is currently pressed. Both</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;are byte values.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;Seventeen local bytes are consumed, and two bytes are used for</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;the output parameters. That's a grand total of nineteen bytes</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >;required when invoking this subroutine.</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >sub readIR_Remote(out IR_rem_dev as byte, out IR_rem_key as byte)</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; dim IR_rem_count, IR_rem_i as byte</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; dim IR_rem_width(12) as byte&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;pulse width array</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; do</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; IR_rem_count = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;wait for start bit</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; do while IR_DATA_PIN = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;measure width (active low)</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait 100 uS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;24 X 100 uS = 2.4 mS</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IR_rem_count++</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; loop</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; loop while IR_rem_count &lt; 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;less than this so wait</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; for IR_rem_i = 1 to 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;read/store the 12 pulses</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; do</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IR_rem_count = 0</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do while IR_DATA_PIN = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;zero = 6 units = 0.6 mS</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait 100 uS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;one = 12 units = 1.2 mS</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IR_rem_count++</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loop</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; loop while IR_rem_count &lt; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;too small to be legit</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; IR_rem_width(IR_rem_i) = IR_rem_count ;else store pulse width</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; next IR_rem_i</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; IR_rem_key = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;command built up here</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; for IR_rem_i = 1 to 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;1st 7 bits are the key</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; IR_rem_key = IR_rem_key / 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;shift into place</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; if IR_rem_width(IR_rem_i) &gt; 10 then&nbsp;&nbsp; ;longer than 10 mS</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IR_rem_key = IR_rem_key + 64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;so call it a one</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; end if</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; next</span></font><font color="#010101" ></font></div><div align="left" ><br></div><font color="#010101" ><div align="left" ></font><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; IR_rem_dev = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;device number built up 
here</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; for IR_rem_i = 8 to 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;next 5 bits are device 
number</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; IR_rem_dev = IR_rem_dev / 2</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; if IR_rem_width( IR_rem_i ) &gt; 10 then</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IR_rem_dev = IR_rem_dev + 16</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp;&nbsp;&nbsp; end if</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >&nbsp; next</span></font><font color="#010101" ></font></div><div align="left" ><font face="Courier New"  color="#010101" ><span style="font-size:10pt" >end sub</span></font><font color="#010101" ></font></div><div align="left" ><font color="#010101" ></font></div>

</html>
